<div xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:i18n="http://genshi.edgewall.org/i18n"
      xmlns:py="http://genshi.edgewall.org/"
      i18n:domain="testmanager"

     id="tm_new_test_catalog_dialog_container"
     style="width: 300px;"
>
    <div py:choose="">
      <h2 py:when="parent_test_catalog is not None">Add a new catalog as a sub-catalog of "${parent_test_catalog.title}"</h2>
      <h2 py:otherwise="">Add a new root test catalog</h2>
    </div>

    <div id="tm_new_test_catalog_message_holder"></div>

    <fieldset>
        <label for="tm_new_test_catalog_name">New test catalog name</label>
        <input id="tm_new_test_catalog_name" name="tm_new_test_catalog_name" size="40" />
    </fieldset>
    
    <div>
        <button id="tm_new_test_catalog_dialog_button_ok">OK</button>
        <button id="tm_new_test_catalog_dialog_button_cancel">Cancel</button>
    </div>

    <script>
    (function($) {
        $(function() {
            $( "#tm_new_test_catalog_dialog_button_ok" ).button({
              text: true,
              icons: {
                primary: "ui-icon-check"
              }
            })
            .click(function() {
              var tcat_name = $("#tm_new_test_catalog_name").val();
              console.info(tcat_name);

              $(this).prop("disabled", true);

              var params = {
                  parent_id: "${parent_id or ''}",
                  title: tcat_name
              };

              doAjaxCall("${base_url}/action/testmanager.actions!create_test_catalog", "GET", params, true, function(data) {
                    var resultJson = data;
                    console.info(resultJson);

                    var output = $.parseJSON(resultJson);
                    
                    if (output.result === "OK") {
                        $("#tm_dialog_anchor").dialog( "close" );
                        tm_loadTestCatalogs("testcatalog", output.id);
                    } else {
                        /* Show error within dialog */
                        $("#tm_new_test_catalog_message_holder").addClass("ui-state-error");
                        $("#tm_new_test_catalog_message_holder").html(output.message);
                        $( this ).enable();
                    }
                });
            });

            $( "#tm_new_test_catalog_dialog_button_cancel" ).button({
              text: true,
              icons: {
                primary: "ui-icon-close"
              }
            })
            .click(function() {
                $("#tm_dialog_anchor").dialog( "close" );
            });
            
          });
    })(jQuery_testmanager);
    </script>

</div>

